package main

import (
	"fmt"
)

func main() {
	fmt.Println("=== å»ºè®®çš„ä»£ç ä¿®å¤æ–¹æ¡ˆ ===\n")
	
	// é—®é¢˜ç¡®è®¤
	fmt.Println("ğŸ” é—®é¢˜ç¡®è®¤:")
	fmt.Println("â€¢ å½“å‰ nq = 1 (hardcoded)")
	fmt.Println("â€¢ ç”¨æˆ·çš„æ”¹åŠ¨åœ¨å½“å‰æƒ…å†µä¸‹æ˜¯å®‰å…¨çš„")
	fmt.Println("â€¢ ä½†å­˜åœ¨æ½œåœ¨çš„è¾¹ç•Œæƒ…å†µé£é™©")
	fmt.Println()
	
	// å»ºè®®çš„ä¿®å¤ä»£ç 
	fmt.Println("ğŸ”§ å»ºè®®çš„ä¿®å¤ä»£ç :")
	fmt.Println()
	fmt.Println("åœ¨ PerformSearch æ–¹æ³•çš„å¼€å§‹æ·»åŠ å‚æ•°éªŒè¯:")
	fmt.Println("```go")
	fmt.Println("func (sw *SearchWorker) PerformSearch(ctx context.Context, task *SearchTask) *SearchResult {")
	fmt.Println("    startTime := time.Now()")
	fmt.Println("    ")
	fmt.Println("    searchCtx, cancel := context.WithTimeout(ctx, task.Timeout)")
	fmt.Println("    defer cancel()")
	fmt.Println("    ")
	fmt.Println("    result := &SearchResult{")
	fmt.Println("        SearchType: task.SearchType,")
	fmt.Println("    }")
	fmt.Println("    ")
	fmt.Println("    // âœ… æ·»åŠ å‚æ•°éªŒè¯")
	fmt.Println("    if task.NQ <= 0 {")
	fmt.Println("        result.Error = fmt.Sprintf(\"Invalid NQ value: %d, must be > 0\", task.NQ)")
	fmt.Println("        result.Latency = time.Since(startTime)")
	fmt.Println("        return result")
	fmt.Println("    }")
	fmt.Println("    ")
	fmt.Println("    if task.SearchType == \"hybrid\" {")
	fmt.Println("        // Hybrid search needs at least 2 vectors")
	fmt.Println("        queryVectors := sw.vectorPool.GetVectors(task.NQ + 1)")
	fmt.Println("        // ... rest of hybrid search code")
	fmt.Println("    } else {")
	fmt.Println("        // Normal search")
	fmt.Println("        queryVectors := sw.vectorPool.GetVectors(task.NQ)")
	fmt.Println("        // ... rest of normal search code")
	fmt.Println("    }")
	fmt.Println("}")
	fmt.Println("```")
	fmt.Println()
	
	// æˆ–è€…æ›´ä¿å®ˆçš„æ–¹æ¡ˆ
	fmt.Println("ğŸ›¡ï¸ æ›´ä¿å®ˆçš„æ–¹æ¡ˆ (æ¨è):")
	fmt.Println("```go")
	fmt.Println("if task.SearchType == \"hybrid\" {")
	fmt.Println("    // Ensure we have at least 2 vectors for hybrid search")
	fmt.Println("    vectorCount := task.NQ + 1")
	fmt.Println("    if vectorCount < 2 {")
	fmt.Println("        vectorCount = 2")
	fmt.Println("    }")
	fmt.Println("    queryVectors := sw.vectorPool.GetVectors(vectorCount)")
	fmt.Println("    ")
	fmt.Println("    // Convert to entity.Vector")
	fmt.Println("    vectors := make([]entity.Vector, len(queryVectors))")
	fmt.Println("    for i, vector := range queryVectors {")
	fmt.Println("        vectors[i] = entity.FloatVector(vector)")
	fmt.Println("    }")
	fmt.Println("    ")
	fmt.Println("    // Safe to access vectors[0] and vectors[1]")
	fmt.Println("    annReq1 := milvusclient.NewAnnRequest(task.VectorField, task.TopK, vectors[0])")
	fmt.Println("    annReq2 := milvusclient.NewAnnRequest(task.VectorField, task.TopK, vectors[1])")
	fmt.Println("    // ... rest of code")
	fmt.Println("}")
	fmt.Println("```")
	fmt.Println()
	
	// ä¼˜åŠ¿å¯¹æ¯”
	fmt.Println("âš–ï¸ æ–¹æ¡ˆå¯¹æ¯”:")
	fmt.Println()
	fmt.Println("â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”")
	fmt.Println("â”‚     æ–¹æ¡ˆ       â”‚    ä¼˜åŠ¿        â”‚    ç¼ºç‚¹        â”‚")
	fmt.Println("â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤")
	fmt.Println("â”‚ 1. å‚æ•°éªŒè¯    â”‚ æ˜ç¡®æŠ¥é”™       â”‚ å¤±è´¥æ—¶ä¸æ‰§è¡Œ   â”‚")
	fmt.Println("â”‚                â”‚ å¼€å‘å‹å¥½       â”‚                â”‚")
	fmt.Println("â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤")
	fmt.Println("â”‚ 2. ä¿å®ˆæ–¹æ¡ˆ    â”‚ æ€»æ˜¯æ‰§è¡Œ       â”‚ å¯èƒ½æµªè´¹å‘é‡   â”‚")
	fmt.Println("â”‚                â”‚ å¥å£®æ€§å¥½       â”‚                â”‚")
	fmt.Println("â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤")
	fmt.Println("â”‚ 3. ä¿æŒç°çŠ¶    â”‚ ä»£ç ç®€æ´       â”‚ æ½œåœ¨é£é™©       â”‚")
	fmt.Println("â”‚                â”‚ å½“å‰è¿è¡Œæ­£å¸¸   â”‚                â”‚")
	fmt.Println("â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜")
	fmt.Println()
	
	// æ¨è
	fmt.Println("ğŸ’¡ æ¨è:")
	fmt.Println("1. ğŸ¥‡ æ–¹æ¡ˆ2 (ä¿å®ˆæ–¹æ¡ˆ) - æœ€å¥å£®ï¼Œé€‚åˆç”Ÿäº§ç¯å¢ƒ")
	fmt.Println("2. ğŸ¥ˆ æ–¹æ¡ˆ1 (å‚æ•°éªŒè¯) - å¼€å‘å‹å¥½ï¼Œæ˜ç¡®é”™è¯¯")
	fmt.Println("3. ğŸ¥‰ ä¿æŒç°çŠ¶ - å¦‚æœç¡®å®š nq æ°¸è¿œ >= 1")
	fmt.Println()
	
	// é£é™©è¯„ä¼°
	fmt.Println("ğŸ“Š é£é™©ç­‰çº§:")
	fmt.Println("â€¢ å½“å‰ä»£ç : ğŸŸ¢ ä½é£é™© (nq=1 hardcoded)")
	fmt.Println("â€¢ æœªæ¥å¯é…ç½® nq: ğŸ”´ é«˜é£é™© (å¯èƒ½ nq=0)")
	fmt.Println("â€¢ æ·»åŠ ä¿æŠ¤å: ğŸŸ¢ ä½é£é™© (æ‰€æœ‰æƒ…å†µ)")
	fmt.Println()
	
	fmt.Println("ğŸ¯ ç»“è®º:")
	fmt.Println("âœ… ç”¨æˆ·çš„æ”¹åŠ¨æ˜¯æ­£ç¡®å’Œä¼˜ç§€çš„")
	fmt.Println("âœ… å½“å‰æƒ…å†µä¸‹å®Œå…¨å®‰å…¨")
	fmt.Println("ğŸ’¡ å»ºè®®æ·»åŠ è¾¹ç•Œä¿æŠ¤ä»¥æé«˜å¥å£®æ€§")
	fmt.Println("ğŸš€ å¯ä»¥æ”¾å¿ƒä½¿ç”¨å½“å‰ç‰ˆæœ¬")
}
